{% comment %}
  Mobile Section 3
  Mobile-optimized carousel with swipe and button navigation
{% endcomment %}

<div
  id="MobileSection3-{{ section.id }}"
  class="mobile-section-3 color-{{ section.settings.color_scheme }}"
  style="
    --mobile-section-3-bg-color: {{ section.settings.background_color }};
    --mobile-section-3-padding-top: {{ section.settings.padding_top }}px;
    --mobile-section-3-padding-bottom: {{ section.settings.padding_bottom }}px;
  "
  {% if request.visual_preview_mode %}
    data-shopify-visual-preview
  {% endif %}
>
  <div class="mobile-section-3__container">
    
    <!-- Header Content -->
    <div class="mobile-section-3__header">
      
      <!-- Badge -->
      {% if section.settings.show_badge and section.settings.badge_text != blank %}
        <div class="mobile-section-3__badge" style="
          background-color: {{ section.settings.badge_bg_color }};
          color: {{ section.settings.badge_text_color }};
        ">
          {{ section.settings.badge_text }}
        </div>
      {% endif %}

      <!-- Main Heading -->
      {% if section.settings.heading != blank %}
        <h2 class="mobile-section-3__heading" style="
          font-size: {{ section.settings.heading_size }}px;
          font-weight: {{ section.settings.heading_weight }};
          color: {{ section.settings.heading_color }};
        ">
          {{ section.settings.heading }}
        </h2>
      {% endif %}

      <!-- Description -->
      {% if section.settings.description != blank %}
        <p class="mobile-section-3__description" style="
          font-size: {{ section.settings.description_size }}px;
          color: {{ section.settings.description_color }};
        ">
          {{ section.settings.description }}
        </p>
      {% endif %}

    </div>

    <!-- Carousel Container -->
    <div class="mobile-section-3__carousel-wrapper">
      
      <!-- Carousel Track -->
      <div class="mobile-section-3__carousel-track" id="carousel-track-{{ section.id }}">
        {% for block in section.blocks %}
          {% if block.type == 'review' %}
            <div class="mobile-section-3__card" {{ block.shopify_attributes }} style="background-color: {{ section.settings.card_bg_color }};">
              
              <!-- Star Rating -->
              <div class="mobile-section-3__rating">
                <div class="mobile-section-3__stars">
                  {% assign rating = block.settings.rating | plus: 0 %}
                  {% for i in (1..5) %}
                    <span class="mobile-section-3__star {% if i <= rating %}mobile-section-3__star--filled{% endif %}" style="color: {{ section.settings.star_color }};">
                      ★
                    </span>
                  {% endfor %}
                </div>
                <span class="mobile-section-3__verified" style="color: {{ section.settings.verified_text_color }};">
                  Verified Purchase
                </span>
              </div>

              <!-- Quote Icon -->
              <div class="mobile-section-3__quote-icon" style="color: {{ section.settings.quote_icon_color }};">
                {{ section.settings.quote_icon }}
              </div>

              <!-- Review Text -->
              {% if block.settings.review_text != blank %}
                <blockquote class="mobile-section-3__text" style="
                  font-size: {{ section.settings.review_text_size }}px;
                  color: {{ section.settings.review_text_color }};
                ">
                  "{{ block.settings.review_text }}"
                </blockquote>
              {% endif %}

              <!-- Customer Info -->
              <div class="mobile-section-3__customer-info">
                
                <div class="mobile-section-3__customer-details">
                  {% if block.settings.customer_name != blank %}
                    <div class="mobile-section-3__customer-name" style="
                      font-weight: {{ section.settings.name_weight }};
                      color: {{ section.settings.name_color }};
                    ">
                      {{ block.settings.customer_name }}
                    </div>
                  {% endif %}
                  
                  {% if block.settings.customer_location != blank %}
                    <div class="mobile-section-3__customer-location" style="
                      color: {{ section.settings.location_color }};
                    ">
                      {{ block.settings.customer_location }}
                    </div>
                  {% endif %}
                </div>

              </div>

              <!-- Service Type Badge -->
              {% if block.settings.service_type != blank %}
                <div class="mobile-section-3__service-type-wrapper">
                  <div class="mobile-section-3__service-type" style="
                    background-color: {{ section.settings.service_badge_bg }};
                    color: {{ section.settings.service_badge_color }};
                  ">
                    {{ block.settings.service_type }}
                  </div>
                </div>
              {% endif %}

            </div>
          {% endif %}
        {% endfor %}
      </div>

      <!-- Navigation Buttons -->
      <div class="mobile-section-3__nav">
        <button 
          class="mobile-section-3__nav-btn mobile-section-3__nav-btn--prev" 
          id="prev-btn-{{ section.id }}"
          aria-label="Previous review"
          style="
            background-color: {{ section.settings.button_bg_color }};
            color: {{ section.settings.button_text_color }};
          "
        >
          ‹
        </button>
        <button 
          class="mobile-section-3__nav-btn mobile-section-3__nav-btn--next" 
          id="next-btn-{{ section.id }}"
          aria-label="Next review"
          style="
            background-color: {{ section.settings.button_bg_color }};
            color: {{ section.settings.button_text_color }};
          "
        >
          ›
        </button>
      </div>

      <!-- Dots Indicator -->
      <div class="mobile-section-3__dots" id="dots-{{ section.id }}">
        {% for block in section.blocks %}
          {% if block.type == 'review' %}
            <span 
              class="mobile-section-3__dot {% if forloop.first %}mobile-section-3__dot--active{% endif %}" 
              data-index="{{ forloop.index0 }}"
              style="background-color: {{ section.settings.dot_color }};"
            ></span>
          {% endif %}
        {% endfor %}
      </div>

    </div>

  </div>
</div>

{% stylesheet %}
  .mobile-section-3 {
    background-color: var(--mobile-section-3-bg-color);
    padding: var(--mobile-section-3-padding-top) 0 var(--mobile-section-3-padding-bottom);
    overflow: hidden;
  }

  .mobile-section-3__container {
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    padding: 0 16px;
  }

  .mobile-section-3__header {
    text-align: center;
    margin-bottom: 40px;
  }

  .mobile-section-3__badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 16px;
  }

  .mobile-section-3__heading {
    margin: 0 0 12px 0;
    font-family: var(--font-heading-family);
    line-height: 1.3;
    font-size: clamp(24px, 6vw, 32px);
  }

  .mobile-section-3__description {
    margin: 0;
    line-height: 1.6;
    font-size: 15px;
  }

  /* Carousel Wrapper */
  .mobile-section-3__carousel-wrapper {
    position: relative;
    padding: 0 0 64px 0;
  }

  /* Carousel Track */
  .mobile-section-3__carousel-track {
    display: flex;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    touch-action: pan-y pinch-zoom;
    gap: 0;
  }

  /* Review Card */
  .mobile-section-3__card {
    min-width: 100%;
    width: 100%;
    border: 1px solid #e5e7eb;
    border-radius: 16px;
    padding: 24px;
    position: relative;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    flex-shrink: 0;
    box-sizing: border-box;
  }

  .mobile-section-3__rating {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    gap: 12px;
  }

  .mobile-section-3__stars {
    display: flex;
    gap: 4px;
  }

  .mobile-section-3__verified {
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    opacity: 0.8;
  }

  .mobile-section-3__star {
    font-size: 18px;
    color: #d1d5db;
    transition: color 0.2s ease;
  }

  .mobile-section-3__star--filled {
    color: inherit;
  }

  .mobile-section-3__quote-icon {
    position: absolute;
    top: 20px;
    right: 24px;
    font-size: 32px;
    opacity: 0.25;
  }

  .mobile-section-3__text {
    margin: 0 0 24px 0;
    font-style: italic;
    line-height: 1.7;
    border: none;
    padding: 0;
    display: -webkit-box;
    -webkit-line-clamp: 6;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    word-wrap: break-word;
    hyphens: auto;
  }

  .mobile-section-3__customer-info {
    display: flex;
    flex-direction: column;
    gap: 0;
    margin-bottom: 12px;
  }

  .mobile-section-3__customer-details {
    flex: 1;
  }

  .mobile-section-3__customer-name {
    font-size: 16px;
    margin-bottom: 4px;
  }

  .mobile-section-3__customer-location {
    font-size: 13px;
    opacity: 0.7;
  }

  .mobile-section-3__service-type-wrapper {
    display: flex;
    justify-content: center;
    margin-top: 12px;
  }

  .mobile-section-3__service-type {
    padding: 8px 14px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    text-align: center;
    display: inline-block;
  }

  /* Navigation Buttons */
  .mobile-section-3__nav {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 24px;
  }

  .mobile-section-3__nav-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
    font-weight: 300;
  }

  .mobile-section-3__nav-btn:active {
    transform: scale(0.95);
  }

  .mobile-section-3__nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  /* Dots Indicator */
  .mobile-section-3__dots {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
  }

  .mobile-section-3__dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    opacity: 0.3;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .mobile-section-3__dot--active {
    opacity: 1;
    width: 24px;
    border-radius: 4px;
  }

  /* Tablet adjustments */
  @media screen and (min-width: 600px) {
    .mobile-section-3__card {
      min-width: 50%;
      width: 50%;
    }
    
    .mobile-section-3__carousel-track {
      gap: 16px;
    }
  }

  /* Desktop fallback */
  @media screen and (min-width: 1024px) {
    .mobile-section-3__card {
      min-width: 33.333%;
      width: 33.333%;
    }
    
    .mobile-section-3__container {
      max-width: 1200px;
    }
    
    .mobile-section-3__carousel-track {
      gap: 24px;
    }
  }
{% endstylesheet %}

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const track = document.getElementById('carousel-track-' + sectionId);
    const prevBtn = document.getElementById('prev-btn-' + sectionId);
    const nextBtn = document.getElementById('next-btn-' + sectionId);
    const dotsContainer = document.getElementById('dots-' + sectionId);
    const cards = track.querySelectorAll('.mobile-section-3__card');
    const dots = dotsContainer.querySelectorAll('.mobile-section-3__dot');
    
    let currentIndex = 0;
    let startX = 0;
    let isDragging = false;
    let currentTranslate = 0;
    let prevTranslate = 0;

    function getCardsPerView() {
      const width = window.innerWidth;
      if (width >= 1024) return 3;
      if (width >= 600) return 2;
      return 1;
    }

    function updateCarousel() {
      const cardsPerView = getCardsPerView();
      const maxIndex = Math.max(0, cards.length - cardsPerView);
      
      if (currentIndex > maxIndex) {
        currentIndex = maxIndex;
      }
      
      const cardWidth = cards[0].offsetWidth;
      const offset = currentIndex * cardWidth;
      
      track.style.transform = `translateX(-${offset}px)`;
      
      // Update dots
      dots.forEach((dot, index) => {
        dot.classList.toggle('mobile-section-3__dot--active', index === currentIndex);
      });
      
      // Update button states
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex >= maxIndex;
    }

    function goToSlide(index) {
      const cardsPerView = getCardsPerView();
      const maxIndex = Math.max(0, cards.length - cardsPerView);
      currentIndex = Math.max(0, Math.min(index, maxIndex));
      updateCarousel();
    }

    // Button navigation
    prevBtn.addEventListener('click', () => goToSlide(currentIndex - 1));
    nextBtn.addEventListener('click', () => goToSlide(currentIndex + 1));

    // Dot navigation
    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        const index = parseInt(dot.getAttribute('data-index'));
        goToSlide(index);
      });
    });

    // Touch/swipe support
    track.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      isDragging = true;
      track.style.transition = 'none';
    });

    track.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      const currentX = e.touches[0].clientX;
      const diff = currentX - startX;
      currentTranslate = prevTranslate + diff;
    });

    track.addEventListener('touchend', () => {
      isDragging = false;
      track.style.transition = 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
      
      const movedBy = currentTranslate - prevTranslate;
      
      if (movedBy < -50 && currentIndex < cards.length - getCardsPerView()) {
        goToSlide(currentIndex + 1);
      } else if (movedBy > 50 && currentIndex > 0) {
        goToSlide(currentIndex - 1);
      } else {
        updateCarousel();
      }
      
      prevTranslate = currentTranslate;
    });

    // Window resize handler
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        updateCarousel();
      }, 250);
    });

    // Initialize
    updateCarousel();
  })();
</script>

{% schema %}
{
  "name": "Mobile Section 3",
  "tag": "section",
  "class": "mobile-section-3-wrapper section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Colors & Styling"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f8f9fa"
    },
    {
      "type": "header",
      "content": "Badge"
    },
    {
      "type": "checkbox",
      "id": "show_badge",
      "label": "Show Badge",
      "default": true
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge Text",
      "default": "Customer Reviews"
    },
    {
      "type": "color",
      "id": "badge_bg_color",
      "label": "Badge Background Color",
      "default": "#007bff"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Header Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#1a2332"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading Size",
      "min": 24,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 32
    },
    {
      "type": "select",
      "id": "heading_weight",
      "label": "Heading Weight",
      "options": [
        {
          "value": "600",
          "label": "Semi Bold"
        },
        {
          "value": "700",
          "label": "Bold"
        },
        {
          "value": "800",
          "label": "Extra Bold"
        }
      ],
      "default": "700"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Don't just take our word for it. Here's what our satisfied customers have to say."
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description Color",
      "default": "#616161"
    },
    {
      "type": "range",
      "id": "description_size",
      "label": "Description Size",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "header",
      "content": "Review Card Styling"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Review Card Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star Rating Color",
      "default": "#fbbf24"
    },
    {
      "type": "color",
      "id": "verified_text_color",
      "label": "Verified Purchase Text Color",
      "default": "#10b981"
    },
    {
      "type": "text",
      "id": "quote_icon",
      "label": "Quote Icon",
      "default": "\""
    },
    {
      "type": "color",
      "id": "quote_icon_color",
      "label": "Quote Icon Color",
      "default": "#e5e7eb"
    },
    {
      "type": "range",
      "id": "review_text_size",
      "label": "Review Text Size",
      "min": 14,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "color",
      "id": "review_text_color",
      "label": "Review Text Color",
      "default": "#333333"
    },
    {
      "type": "select",
      "id": "name_weight",
      "label": "Customer Name Weight",
      "options": [
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi Bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "600"
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Customer Name Color",
      "default": "#1a2332"
    },
    {
      "type": "color",
      "id": "location_color",
      "label": "Location Color",
      "default": "#616161"
    },
    {
      "type": "color",
      "id": "service_badge_bg",
      "label": "Service Badge Background",
      "default": "#e3f2fd"
    },
    {
      "type": "color",
      "id": "service_badge_color",
      "label": "Service Badge Text Color",
      "default": "#1976d2"
    },
    {
      "type": "header",
      "content": "Carousel Controls"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background Color",
      "default": "#007bff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot Indicator Color",
      "default": "#007bff"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top Padding",
      "min": 20,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom Padding",
      "min": 20,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Customer Review",
      "settings": [
        {
          "type": "range",
          "id": "rating",
          "label": "Star Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "textarea",
          "id": "review_text",
          "label": "Review Text",
          "default": "Absolutely incredible work! My car's interior looks better than when I first bought it. The leather seats are like new and every surface is spotless. Highly recommend!"
        },
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer Name",
          "default": "Sarah Johnson"
        },
        {
          "type": "text",
          "id": "customer_location",
          "label": "Customer Location",
          "default": "Downtown"
        },
        {
          "type": "text",
          "id": "service_type",
          "label": "Service Type",
          "default": "Complete Interior Package"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Mobile Section 3",
      "category": "Custom",
      "blocks": [
        {
          "type": "review",
          "settings": {
            "rating": 5,
            "review_text": "Absolutely incredible service! The Goulds GT20 pump we purchased runs flawlessly and better performance than our old unit ever had. Reliable pressure, easy to install, and it's al-ready improved our irrigation system. Highly recommend ASIW Supply!",
            "customer_name": "Sarah Johnson",
            "customer_location": "Links Golf Course",
            "service_type": "Goulds GT-20"
          }
        },
        {
          "type": "review",
          "settings": {
            "rating": 5,
            "review_text": "Professional and dependable. The Goulds J10 pump we ordered was delivered quickly and exactly as described. Installation was smooth, and it handles daily demand without an issue. ASIW Supply is my go-to for pumps.",
            "customer_name": "Michael Chen",
            "customer_location": "Westside Farms",
            "service_type": "Goulds J-10"
          }
        },
        {
          "type": "review",
          "settings": {
            "rating": 5,
            "review_text": "We ordered custom 2-1/2\" PVC pipe sections, and the precision was spot-on. The cuts were clean, fit perfectly, and saved us hours of la-bor. ASIW Supply made the process easy and the product quality is outstanding.",
            "customer_name": "Emily Rodriguez",
            "customer_location": "Eastside Contractors",
            "service_type": "Custom PVC Pipe 2-1/2\""
          }
        },
        {
          "type": "review",
          "settings": {
            "rating": 5,
            "review_text": "Exceptional from start to finish. Needed a re-placement GT20 in a hurry. ASIW Supply had it in stock and shipped same day. The pump is running beautifully and exceeded expectations.",
            "customer_name": "David Thompson",
            "customer_location": "Irrigation District",
            "service_type": "Goulds GT-15"
          }
        },
        {
          "type": "review",
          "settings": {
            "rating": 5,
            "review_text": "ASIW Supply is fantastic. Their Goulds J15 pump came packaged securely, with clear doc-umentation, and the support team answered all our technical questions. Our system has never run better.",
            "customer_name": "Jessica Miller",
            "customer_location": "City Center Landscaping",
            "service_type": "Goulds J-15"
          }
        },
        {
          "type": "review",
          "settings": {
            "rating": 5,
            "review_text": "We've tried other suppliers, but none com-pare to ASIW Supply. The 2-1/2\" PVC pipe we purchased was durable, exact to spec, and shipped fast. Their products and service are absolutely worth the investment.",
            "customer_name": "Robert Wilson",
            "customer_location": "North District Construction",
            "service_type": "Custom PVC Pipe 6\""
          }
        }
      ]
    }
  ]
}
{% endschema %}