{% comment %}
  Section: features-icons-grid (PNG version)
  Purpose: 4-up features with PNG image uploads instead of SVG icons.
  Notes:
  - Per-block PNG via image_picker
  - A11y: section landmark, aria-labelledby, focus rings
  - Self-contained CSS
  - Font consistency with theme typography
  - Enhanced mobile support: 1-4 columns
{% endcomment %}

{%- liquid
  assign heading          = section.settings.heading
  assign subheading       = section.settings.subheading
  assign max_width        = section.settings.max_width | default: 1160
  assign bg               = section.settings.background_color | default: '#F5F7FA'
  assign head_color       = section.settings.heading_color | default: '#111827'
  assign text_color       = section.settings.text_color | default: '#64748B'
  assign blue_start       = section.settings.accent_blue_start | default: '#1976D2'
  assign blue_end         = section.settings.accent_blue_end | default: '#1E88E5'
  assign radius           = section.settings.icon_bg_radius | default: 14
  assign icon_size        = section.settings.icon_size | default: 24
  assign cols_desktop     = section.settings.columns_desktop | default: '4'
  assign cols_tablet      = section.settings.columns_tablet | default: '2'
  assign cols_mobile      = section.settings.columns_mobile | default: '1'
  assign gap_desktop      = section.settings.gap_desktop | default: 28
  assign gap_mobile       = section.settings.gap_mobile | default: 16
  assign pad_top          = section.settings.padding_top | default: 64
  assign pad_bottom       = section.settings.padding_bottom | default: 64
  assign align            = section.settings.align | default: 'center'
  assign show_dividers    = section.settings.show_dividers

  assign png_wh = icon_size | times: 2
-%}

<section class="features-icons-grid features-icons-grid--{{ section.id }}"
  aria-labelledby="{% if heading != blank %}features-title-{{ section.id }}{% else %}features-label-{{ section.id }}{% endif %}"
  role="region">

  <style>
    .features-icons-grid--{{ section.id }}{
      --sig-bg: {{ bg }};
      --sig-head: {{ head_color }};
      --sig-text: {{ text_color }};
      --sig-blue-start: {{ blue_start }};
      --sig-blue-end: {{ blue_end }};
      --sig-radius: {{ radius }}px;
      --sig-icon-size: {{ icon_size }}px;
      --sig-gap: {{ gap_desktop }}px;
      --sig-gap-mobile: {{ gap_mobile }}px;
      --sig-container: {{ max_width }}px;

      background: var(--sig-bg);
      padding-top: {{ pad_top }}px;
      padding-bottom: {{ pad_bottom }}px;
      font-family: inherit; /* Inherit theme fonts */
      {% if show_dividers %}
      border-top: 1px solid rgba(0,0,0,.05);
      border-bottom: 1px solid rgba(0,0,0,.05);
      {% endif %}
    }

    .features-icons-grid--{{ section.id }} .sig-wrap{
      max-width: var(--sig-container);
      margin: 0 auto;
      padding-inline: 16px;
    }

    .features-icons-grid--{{ section.id }} .sig-heading{
      color: var(--sig-head);
      font-family: var(--font-heading-family, inherit); /* Use theme's heading font */
      font-weight: 700;
      letter-spacing: -0.01em;
      text-align: {{ align }};
      margin: 0 0 20px 0px;
      font-size: clamp(1.5rem, 2vw + 1rem, 2rem);
      line-height: 1.2;
    }

    .features-icons-grid--{{ section.id }} .sig-subheading{
      color: var(--sig-text);
      font-family: var(--font-body-family, inherit); /* Use theme's body font */
      text-align: {{ align }};
      margin: 0 0 28px 0;
      line-height: 1.6;
    }

    .features-icons-grid--{{ section.id }} .sig-grid{
      display: grid;
      gap: var(--sig-gap);
      align-items: start;
      justify-items: center;
      grid-template-columns: repeat({{ cols_desktop }}, minmax(0,1fr));
    }
    @media (max-width: 1024px){
      .features-icons-grid--{{ section.id }} .sig-grid{
        grid-template-columns: repeat({{ cols_tablet }}, minmax(0,1fr));
      }
    }
    @media (max-width: 640px){
      .features-icons-grid--{{ section.id }} .sig-grid{
        grid-template-columns: repeat({{ cols_mobile }}, minmax(0,1fr));
        gap: var(--sig-gap-mobile);
      }
      .features-icons-grid--{{ section.id }} .sig-subheading{ margin-bottom: 20px; }
      
      /* Hide individual features on mobile based on block setting */
      .features-icons-grid--{{ section.id }} .sig-item[data-hide-mobile="true"]{
        display: none;
      }
      
      /* Adjust icon and text sizing for 3-4 column mobile layouts */
      {% if cols_mobile == '3' or cols_mobile == '4' %}
      .features-icons-grid--{{ section.id }} .sig-icon{
        width: 48px;
        height: 48px;
      }
      .features-icons-grid--{{ section.id }} .sig-icon img{
        width: calc(var(--sig-icon-size) * 1.5);
      }
      .features-icons-grid--{{ section.id }} .sig-title{
        font-size: 1rem;
      }
      .features-icons-grid--{{ section.id }} .sig-desc{
        font-size: 0.875rem;
      }
      {% endif %}
    }

    .features-icons-grid--{{ section.id }} .sig-item{
      width: 100%;
      text-align: {{ align }};
      font-family: inherit; /* Ensure font inheritance */
    }

    .features-icons-grid--{{ section.id }} .sig-link{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: var(--font-body-family, inherit); /* Use theme's body font for links */
      font-weight: 600;
      text-decoration: none;
      color: var(--sig-head);
      outline: none;
      border-radius: 10px;
      padding: 2px 4px;
    }
    .features-icons-grid--{{ section.id }} .sig-link:focus-visible{
      box-shadow: 0 0 0 3px rgba(30,136,229,.35);
    }

    .features-icons-grid--{{ section.id }} .sig-icon{
      width: 64px; height: 64px;
      display: inline-grid;
      place-items: center;
      border-radius: var(--sig-radius);
      background: linear-gradient(180deg, var(--sig-blue-start), var(--sig-blue-end));
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
      transition: transform .18s ease, box-shadow .18s ease;
      margin: 0 auto 12px auto;
      overflow: hidden;
    }
    .features-icons-grid--{{ section.id }} .sig-icon img{
      width: calc(var(--sig-icon-size) * 2);
      height: auto;
      display: block;
    }
    .features-icons-grid--{{ section.id }} .sig-item:hover .sig-icon{
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
    }
    .features-icons-grid--{{ section.id }} .sig-focusable:focus-visible .sig-icon{
      box-shadow: 0 0 0 3px rgba(30,136,229,.35), 0 6px 14px rgba(0,0,0,.08);
      transform: translateY(-1px);
    }

    .features-icons-grid--{{ section.id }} .sig-title{
      color: var(--sig-head);
      font-family: var(--font-heading-family, inherit); /* Use theme's heading font for feature titles */
      font-weight: 600;
      margin: 0 0 6px 0;
      font-size: 1.2rem;
      line-height: 1.35;
    }
    .features-icons-grid--{{ section.id }} .sig-desc{
      color: var(--sig-text);
      font-family: var(--font-body-family, inherit); /* Use theme's body font for descriptions */
      margin: 0;
      font-size: 1rem;
      line-height: 1.55;
    }

    /* Ensure all elements inherit theme typography */
    .features-icons-grid--{{ section.id }} *{
      font-family: inherit;
    }

    /* Override specific elements with theme font variables */
    .features-icons-grid--{{ section.id }} h2,
    .features-icons-grid--{{ section.id }} h3,
    .features-icons-grid--{{ section.id }} .sig-heading,
    .features-icons-grid--{{ section.id }} .sig-title{
      font-family: var(--font-heading-family, inherit);
    }

    .features-icons-grid--{{ section.id }} p,
    .features-icons-grid--{{ section.id }} div,
    .features-icons-grid--{{ section.id }} a,
    .features-icons-grid--{{ section.id }} .sig-subheading,
    .features-icons-grid--{{ section.id }} .sig-desc,
    .features-icons-grid--{{ section.id }} .sig-link{
      font-family: var(--font-body-family, inherit);
    }

    {% if align == 'left' %}
    .features-icons-grid--{{ section.id }} .sig-item{ text-align: left; }
    .features-icons-grid--{{ section.id }} .sig-icon{ margin-left: 0; }
    {% endif %}
  </style>

  <div class="sig-wrap">
    {% if heading != blank %}
      <h2 id="features-title-{{ section.id }}" class="sig-heading">{{ heading | escape }}</h2>
    {% else %}
      <span id="features-label-{{ section.id }}" class="visually-hidden">Features</span>
    {% endif %}

    {% if subheading != blank %}
      <div class="sig-subheading">{{ subheading }}</div>
    {% endif %}

    <div
        id="sig-grid-{{ section.id }}"
        class="sig-grid"
        role="list"
        aria-roledescription="list"
        aria-label="{{ heading | default: 'Features' | escape }}"
    >
      {%- for block in section.blocks -%}
        {%- liquid
          assign img            = block.settings.icon_png
          assign img_alt        = block.settings.icon_png_alt
          assign icon_bg_custom = block.settings.icon_bg_custom
          assign title          = block.settings.title
          assign desc           = block.settings.description
          assign link_label     = block.settings.link_label
          assign link_url       = block.settings.link_url
          assign aria_label     = block.settings.aria_label
          assign icon_only      = block.settings.icon_only
          assign hide_mobile    = block.settings.hide_on_mobile | default: false
        -%}

        {%- capture icon_markup -%}
          <div class="sig-icon" style="{% if icon_bg_custom != blank %}background: {{ icon_bg_custom }};{% endif %}">
            {%- if img != blank -%}
              <img
                srcset="{{ img | image_url: width: 64 }} 64w, {{ img | image_url: width: 96 }} 96w, {{ img | image_url: width: 128 }} 128w"
                src="{{ img | image_url: width: 96 }}"
                width="{{ png_wh }}" height="{{ png_wh }}"
                alt="{{ img_alt | escape }}"
                loading="lazy">
            {%- else -%}
              <img src="{{ 'placeholder-image.png' | asset_url }}" alt="" width="{{ png_wh }}" height="{{ png_wh }}" loading="lazy" style="opacity:.0">
            {%- endif -%}
          </div>
        {%- endcapture -%}

        <div class="sig-item" role="listitem" data-hide-mobile="{{ hide_mobile }}" {{ block.shopify_attributes }}>
          {%- assign link_open = '' -%}
          {%- assign link_close = '' -%}
          {%- if link_url != blank -%}
            {%- assign computed_label = aria_label | default: title -%}
            {%- capture link_open -%}<a class="sig-link sig-focusable" href="{{ link_url }}" aria-label="{{ computed_label | escape }}">{%- endcapture -%}
            {%- assign link_close = '</a>' -%}
          {%- endif -%}

          {{ link_open }}
            {{ icon_markup }}
            {%- unless icon_only -%}
              {%- if title != blank -%}
                <h3 class="sig-title">{{ title | escape }}</h3>
              {%- endif -%}
            {%- endunless -%}
          {{ link_close }}

          {%- unless icon_only -%}
            {%- if desc != blank -%}
              <p class="sig-desc">{{ desc | escape }}</p>
            {%- endif -%}
          {%- endunless -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Features Bar",
  "tag": "section",
  "class": "section features-icons-grid",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Wholesale program benefits" },
    { "type": "richtext", "id": "subheading", "label": "Subheading", "default": "<p>Access exclusive savings and support designed for growing businesses.</p>" },
    { "type": "range", "id": "max_width", "min": 800, "max": 1400, "step": 10, "unit": "px", "label": "Max content width", "default": 1160 },

    { "type": "color", "id": "background_color", "label": "Background color", "default": "#F5F7FA" },
    { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#2B2C2D" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#6B7280" },

    { "type": "color", "id": "accent_blue_start", "label": "Tile gradient start", "default": "#005496" },
    { "type": "color", "id": "accent_blue_end", "label": "Tile gradient end", "default": "#1D6AE5" },

    { "type": "range", "id": "icon_bg_radius", "min": 8, "max": 20, "step": 1, "unit": "px", "label": "Tile corner radius", "default": 14 },
    { "type": "range", "id": "icon_size", "min": 20, "max": 36, "step": 1, "unit": "px", "label": "PNG scale (base unit)", "default": 24 },

    { "type": "select", "id": "columns_desktop", "label": "Columns on desktop", "options": [ { "value": "3", "label": "3" }, { "value": "4", "label": "4" } ], "default": "4" },
    { "type": "select", "id": "columns_tablet", "label": "Columns on tablet", "options": [ { "value": "2", "label": "2" }, { "value": "3", "label": "3" } ], "default": "2" },
    { "type": "select", "id": "columns_mobile", "label": "Columns on mobile", "options": [ 
      { "value": "1", "label": "1" }, 
      { "value": "2", "label": "2" },
      { "value": "3", "label": "3" },
      { "value": "4", "label": "4" }
    ], "default": "1" },

    { "type": "range", "id": "gap_desktop", "min": 16, "max": 40, "step": 1, "unit": "px", "label": "Grid gap (desktop)", "default": 28 },
    { "type": "range", "id": "gap_mobile", "min": 8, "max": 24, "step": 1, "unit": "px", "label": "Grid gap (mobile)", "default": 16 },

    { "type": "range", "id": "padding_top", "min": 0, "max": 120, "step": 2, "unit": "px", "label": "Padding top", "default": 64 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 120, "step": 2, "unit": "px", "label": "Padding bottom", "default": 64 },

    { "type": "select", "id": "align", "label": "Text alignment", "options": [ { "value": "center", "label": "Center" }, { "value": "left", "label": "Left" } ], "default": "center" },

    { "type": "checkbox", "id": "show_dividers", "label": "Show faint top/bottom dividers", "default": false }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature",
      "settings": [
        { "type": "image_picker", "id": "icon_png", "label": "PNG icon (recommended transparent background)" },
        { "type": "text", "id": "icon_png_alt", "label": "PNG alt text (leave blank if decorative)" },
        { "type": "color", "id": "icon_bg_custom", "label": "Tile background override (optional)" },

        { "type": "text", "id": "title", "label": "Title", "default": "Feature title" },
        { "type": "textarea", "id": "description", "label": "Description", "default": "Short supporting copy about the benefit." },

        { "type": "text", "id": "link_label", "label": "Link label (optional)" },
        { "type": "url", "id": "link_url", "label": "Link URL (optional)" },
        { "type": "text", "id": "aria_label", "label": "Accessible label (if linked)" },

        { "type": "checkbox", "id": "icon_only", "label": "Icon only (hide text)", "default": false },
        { "type": "checkbox", "id": "hide_on_mobile", "label": "Hide this feature on mobile", "default": false }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [
    {
      "name": "Features Bar",
      "category": "Text",
      "settings": {
        "heading": "Wholesale program benefits",
        "subheading": "<p>Access exclusive savings and support designed for growing businesses.</p>"
      },
      "blocks": [
        { "type": "feature", "settings": { "title": "Authorized Distributor", "description": "Direct partnerships with top manufacturers" } },
        { "type": "feature", "settings": { "title": "Exclusive Wholesale Discounts", "description": "Up to 30% savings on bulk orders" } },
        { "type": "feature", "settings": { "title": "Dedicated Support", "description": "Personal wholesale account management" } },
        { "type": "feature", "settings": { "title": "Nationwide Delivery", "description": "Fast shipping across the United States" } }
      ]
    }
  ]
}
{% endschema %}